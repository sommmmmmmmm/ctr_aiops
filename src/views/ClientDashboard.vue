<template>
  <div class="client-dashboard">
    <!-- ÌïµÏã¨ ÎßàÏºÄÌåÖ KPI -->
    <el-row :gutter="20" class="kpi-row">
      <el-col :span="6">
        <el-card class="kpi-card gradient-blue">
          <div class="kpi-content">
            <div class="kpi-icon">
              <el-icon :size="40"><TrendCharts /></el-icon>
            </div>
            <div class="kpi-info">
              <div class="kpi-label">ROAS</div>
              <div class="kpi-value">{{ businessMetrics.roas }}x</div>
              <div class="kpi-change positive">
                <el-icon><CaretTop /></el-icon>
                Ï†ÑÏõî ÎåÄÎπÑ +{{ businessMetrics.roasChange }}%
              </div>
            </div>
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="kpi-card gradient-green">
          <div class="kpi-content">
            <div class="kpi-icon">
              <el-icon :size="40"><User /></el-icon>
            </div>
            <div class="kpi-info">
              <div class="kpi-label">CAC</div>
              <div class="kpi-value">{{ businessMetrics.cac.toLocaleString() }}Ïõê</div>
              <div class="kpi-change positive">
                <el-icon><CaretBottom /></el-icon>
                Ï†ÑÏõî ÎåÄÎπÑ {{ businessMetrics.cacChange }}%
              </div>
            </div>
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="kpi-card gradient-purple">
          <div class="kpi-content">
            <div class="kpi-icon">
              <el-icon :size="40"><Money /></el-icon>
            </div>
            <div class="kpi-info">
              <div class="kpi-label">LTV</div>
              <div class="kpi-value">{{ businessMetrics.ltv.toLocaleString() }}Ïõê</div>
              <div class="kpi-change positive">
                <el-icon><CaretTop /></el-icon>
                Ï†ÑÏõî ÎåÄÎπÑ +{{ businessMetrics.ltvChange }}%
              </div>
            </div>
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="kpi-card gradient-orange">
          <div class="kpi-content">
            <div class="kpi-icon">
              <el-icon :size="40"><DataAnalysis /></el-icon>
            </div>
            <div class="kpi-info">
              <div class="kpi-label">Ïã†Í∑ú Í≥†Í∞ù ROAS</div>
              <div class="kpi-value">{{ businessMetrics.newCustomerROAS }}x</div>
              <div class="kpi-change positive">
                <el-icon><CaretTop /></el-icon>
                Ï†ÑÏõî ÎåÄÎπÑ +{{ businessMetrics.newCustomerROASChange }}%
              </div>
            </div>
          </div>
        </el-card>
      </el-col>
    </el-row>

    <!-- AI ÏÉùÏÑ± Ïù∏ÏÇ¨Ïù¥Ìä∏ -->
    <el-row :gutter="20" style="margin-top: 20px">
      <el-col :span="16">
        <el-card class="insights-card">
          <template #header>
            <div class="card-header">
              <span>AI ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏</span>
              <el-tag type="success">Ïã§ÏãúÍ∞Ñ Î∂ÑÏÑù</el-tag>
            </div>
          </template>
          <div class="insights-list">
            <div
              v-for="(insight, index) in aiInsights"
              :key="index"
              class="insight-item"
              :class="`insight-${insight.type}`"
            >
              <div class="insight-header">
                <div class="insight-icon">{{ insight.icon }}</div>
                <div class="insight-content">
                  <h4>{{ insight.title }}</h4>
                  <p>{{ insight.message }}</p>
                </div>
              </div>
              <div v-if="insight.details" class="insight-details">
                <el-tag
                  v-for="(detail, idx) in insight.details"
                  :key="idx"
                  size="small"
                  class="detail-tag"
                >
                  {{ detail }}
                </el-tag>
              </div>
              <div v-if="insight.action" class="insight-action">
                <el-button type="primary" size="small" @click="applyRecommendation(insight)">
                  {{ insight.action }}
                </el-button>
              </div>
            </div>
          </div>
        </el-card>
      </el-col>

      <el-col :span="8">
        <el-card>
          <template #header>
            <span>ÌÄµ Ïï°ÏÖò</span>
          </template>
          <div class="quick-actions">
            <el-button
              type="primary"
              :icon="Upload"
              size="large"
              class="action-btn"
              @click="goToUpload"
            >
              ÏÉà Îç∞Ïù¥ÌÑ∞ ÏóÖÎ°úÎìú
            </el-button>
            <el-button
              type="success"
              :icon="Document"
              size="large"
              class="action-btn"
              @click="viewFullReport"
            >
              Ï†ÑÏ≤¥ Î≥¥Í≥†ÏÑú Î≥¥Í∏∞
            </el-button>
            <el-button
              type="success"
              :icon="Download"
              size="large"
              class="action-btn"
              :loading="downloadingPDF"
              @click="downloadReport"
            >
              PDF Î≥¥Í≥†ÏÑú Îã§Ïö¥Î°úÎìú
            </el-button>
          </div>
        </el-card>

        <el-card style="margin-top: 20px">
          <template #header>
            <span>ÏÑ±Í≥º ÏöîÏïΩ</span>
          </template>
          <el-timeline>
            <el-timeline-item
              v-for="(item, index) in performanceSummary"
              :key="index"
              :timestamp="item.date"
              :color="item.color"
            >
              <strong>{{ item.title }}</strong>
              <p>{{ item.description }}</p>
            </el-timeline-item>
          </el-timeline>
        </el-card>
      </el-col>
    </el-row>

    <!-- ÏÇ¨Ïö©Ïûê ÌñâÎèô Ìå®ÌÑ¥ Î∂ÑÏÑù -->
    <el-row :gutter="20" style="margin-top: 20px">
      <el-col :span="12">
        <el-card>
          <template #header>
            <span>üë• ÌÉÄÍ≤ü Í≥†Í∞ù ÏÑ∏Í∑∏Î®ºÌä∏ Î∂ÑÏÑù</span>
          </template>
          <div class="segment-analysis">
            <div
              v-for="segment in customerSegments"
              :key="segment.name"
              class="segment-item"
            >
              <div class="segment-header">
                <span class="segment-name">{{ segment.name }}</span>
                <el-tag :type="segment.performance">{{ segment.label }}</el-tag>
              </div>
              <div class="segment-metrics">
                <div class="metric">
                  <span class="metric-label">ROAS</span>
                  <span class="metric-value">{{ segment.roas }}x</span>
                </div>
                <div class="metric">
                  <span class="metric-label">CAC</span>
                  <span class="metric-value">{{ segment.cac.toLocaleString() }}Ïõê</span>
                </div>
                <div class="metric">
                  <span class="metric-label">LTV</span>
                  <span class="metric-value">{{ segment.ltv.toLocaleString() }}Ïõê</span>
                </div>
                <div class="metric">
                  <span class="metric-label">CTR</span>
                  <span class="metric-value">{{ segment.ctr }}%</span>
                </div>
                <div class="metric">
                  <span class="metric-label">CVR</span>
                  <span class="metric-value">{{ segment.cvr }}%</span>
                </div>
                <div class="metric">
                  <span class="metric-label">ÏÉÅÍ¥ÄÍ≥ÑÏàò</span>
                  <span class="metric-value">{{ segment.correlation }}</span>
                </div>
              </div>
              <el-progress
                :percentage="segment.potential"
                :color="customColors"
                :stroke-width="8"
              >
                <span class="progress-text">ÏÑ±Ïû• Ïû†Ïû¨Î†•: {{ segment.potential }}%</span>
              </el-progress>
            </div>
          </div>
        </el-card>
      </el-col>

      <el-col :span="12">
        <el-card>
          <template #header>
            <span>‚è∞ ÏµúÏ†Å Í¥ëÍ≥† ÏãúÍ∞ÑÎåÄ</span>
          </template>
          <div class="time-analysis">
            <div
              v-for="timeSlot in optimalTimeSlots"
              :key="timeSlot.period"
              class="time-slot"
              :class="{ 'best-time': timeSlot.isBest }"
            >
              <div class="time-period">
                <el-icon :size="20"><Clock /></el-icon>
                <span>{{ timeSlot.period }}</span>
              </div>
              <div class="time-metrics">
                <div class="time-ctr">
                  <span class="label">CTR</span>
                  <el-progress
                    :percentage="timeSlot.ctr"
                    :color="timeSlot.color"
                    :stroke-width="12"
                  />
                </div>
                <div class="time-traffic">
                  <span class="traffic-value">{{ timeSlot.traffic }}</span>
                  <span class="traffic-label">ÏòàÏÉÅ Ìä∏ÎûòÌîΩ</span>
                </div>
                <div class="time-scroll">
                  <span class="scroll-value">{{ timeSlot.scrollDepth }}</span>
                  <span class="scroll-label">Ïä§ÌÅ¨Î°§ ÍπäÏù¥</span>
                </div>
                <div class="time-exposure">
                  <span class="exposure-value">{{ timeSlot.exposureCount }}</span>
                  <span class="exposure-label">7Ïùº ÎÖ∏Ï∂ú</span>
                </div>
              </div>
              <div v-if="timeSlot.isBest" class="best-badge">
                <el-icon><Star /></el-icon>
                Ï∂îÏ≤ú ÏãúÍ∞ÑÎåÄ
              </div>
            </div>
          </div>
        </el-card>
      </el-col>
    </el-row>

    <!-- ÎßàÏºÄÌåÖ Ïö©Ïñ¥ Ï∞∏Í≥†Ìëú -->
    <el-row :gutter="20" style="margin-top: 20px">
      <el-col :span="24">
        <el-card>
          <template #header>
            <span>üìö ÎßàÏºÄÌåÖ Ïö©Ïñ¥ Ï∞∏Í≥†Ìëú</span>
          </template>
          <el-table :data="marketingTerms" style="width: 100%" size="small">
            <el-table-column prop="term" label="Ïö©Ïñ¥" width="200" />
            <el-table-column prop="korean" label="ÌïúÍµ≠Ïñ¥" width="150" />
            <el-table-column prop="description" label="ÏÑ§Î™Ö" />
          </el-table>
        </el-card>
      </el-col>
    </el-row>

    <!-- ÎßàÏºÄÌåÖ Ï†ÑÎûµ Ï∂îÏ≤ú -->
    <el-row :gutter="20" style="margin-top: 20px">
      <el-col :span="24">
        <el-card>
          <template #header>
            <div class="card-header">
              <span>AI Ï∂îÏ≤ú ÎßàÏºÄÌåÖ Ï†ÑÎûµ</span>
              <el-button type="text" @click="refreshRecommendations">
                <el-icon><Refresh /></el-icon>
                ÏÉàÎ°úÍ≥†Ïπ®
              </el-button>
            </div>
          </template>
          <el-row :gutter="20">
            <el-col
              v-for="strategy in marketingStrategies"
              :key="strategy.id"
              :span="8"
            >
              <div class="strategy-card" :class="`priority-${strategy.priority}`">
                <div class="strategy-header">
                  <el-tag :type="getPriorityType(strategy.priority)" size="large">
                    {{ strategy.priorityLabel }}
                  </el-tag>
                  <span class="strategy-impact">ÏòàÏÉÅ Ìö®Í≥º: +{{ strategy.impact }}%</span>
                </div>
                <h3>{{ strategy.title }}</h3>
                <p>{{ strategy.description }}</p>
                <div class="strategy-details">
                  <div class="detail-item">
                    <el-icon><Calendar /></el-icon>
                    <span>Ïã§Ìñâ Í∏∞Í∞Ñ: {{ strategy.duration }}</span>
                  </div>
                  <div class="detail-item">
                    <el-icon><Money /></el-icon>
                    <span>ÏòàÏÉÅ ÎπÑÏö©: {{ strategy.budget }}</span>
                  </div>
                  <div class="detail-item">
                    <el-icon><TrendCharts /></el-icon>
                    <span>ÏòàÏÉÅ ROAS: {{ strategy.expectedROAS }}x</span>
                  </div>
                  <div class="detail-item">
                    <el-icon><User /></el-icon>
                    <span>ÏòàÏÉÅ CAC: {{ strategy.expectedCAC.toLocaleString() }}Ïõê</span>
                  </div>
                </div>
                <el-button
                  type="primary"
                  class="strategy-action"
                  @click="viewStrategyDetails(strategy)"
                >
                  ÏÉÅÏÑ∏ Î≥¥Í∏∞
                </el-button>
              </div>
            </el-col>
          </el-row>
        </el-card>
      </el-col>
    </el-row>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'
import { useRouter } from 'vue-router'
import { ElMessage } from 'element-plus'
import {
  TrendCharts,
  Money,
  User,
  CaretTop,
  CaretBottom,
  Upload,
  Document,
  Download,
  Clock,
  Star,
  Refresh,
  Calendar,
  DataAnalysis
} from '@element-plus/icons-vue'
import api from '@/api'

const router = useRouter()

// State
const downloadingPDF = ref(false)

// ÌïµÏã¨ ÎßàÏºÄÌåÖ KPI
const businessMetrics = ref({
  roas: 4.2, // Return On Ad Spend
  roasChange: 15.3,
  cac: 12500, // Customer Acquisition Cost
  cacChange: -8.2,
  ltv: 185000, // Customer Lifetime Value
  ltvChange: 12.7,
  mer: 0.28, // Marketing Efficiency Ratio
  merChange: 5.1,
  newCustomerROAS: 3.8,
  newCustomerROASChange: 22.1,
  vtr: 2.3, // View-Through Rate
  vtrChange: 18.5
})

// AI Ïù∏ÏÇ¨Ïù¥Ìä∏ - ÎßàÏºÄÌåÖ KPI Í∏∞Î∞ò Ï†ÑÎûµÏ†Å Ïù∏ÏÇ¨Ïù¥Ìä∏
const aiInsights = ref([
  {
    icon: 'üí∞',
    type: 'success',
    title: 'ROAS 4.2x Îã¨ÏÑ± - Ïπ¥ÌÖåÍ≥†Î¶¨ ID 15 √ó Ïä§ÌÅ¨Î°§ 80%+ Ï°∞Ìï©Ïù¥ ÌïµÏã¨',
    message: 'Ïπ¥ÌÖåÍ≥†Î¶¨ ID 15(ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº)ÏóêÏÑú Ïä§ÌÅ¨Î°§ ÍπäÏù¥ 80% Ïù¥ÏÉÅ ÏÇ¨Ïö©Ïûê ÏÑ∏Í∑∏Î®ºÌä∏Ïùò ROASÍ∞Ä 6.8xÎ°ú Ï†ÑÏ≤¥ ÌèâÍ∑† ÎåÄÎπÑ 62% ÎÜíÏäµÎãàÎã§. Ïù¥ Ï°∞Ìï©Ïóê Í¥ëÍ≥† ÏòàÏÇ∞Ïùò 35%Î•º Ïû¨Î∞∞ÏπòÌïòÎ©¥ Ï†ÑÏ≤¥ ROASÍ∞Ä 5.1xÎ°ú ÏÉÅÏäπÌï† Í≤ÉÏúºÎ°ú ÏòàÏÉÅÎê©ÎãàÎã§.',
    details: ['Ï°∞Ìï© ROAS: 6.8x', 'ÌòÑÏû¨ Ï†ÑÏ≤¥ ROAS: 4.2x', 'ÏòàÏÉÅ ROAS Ï¶ùÍ∞Ä: +21%'],
    action: 'ÏòàÏÇ∞ Ïû¨Î∞∞Ïπò Ïã§Ìñâ'
  },
  {
    icon: 'üìà',
    type: 'warning',
    title: 'CAC ÏµúÏ†ÅÌôî Í∏∞Ìöå - 7Ïùº ÎÖ∏Ï∂ú 3-5Ìöå ÏÑ∏Í∑∏Î®ºÌä∏ Í≥ºÏÜåÎÖ∏Ï∂ú',
    message: '7Ïùº ÎÖ∏Ï∂ú ÌöüÏàò 3-5Ìöå ÏÇ¨Ïö©Ïûê Í∑∏Î£πÏùò CACÍ∞Ä 8,500ÏõêÏúºÎ°ú Ï†ÑÏ≤¥ ÌèâÍ∑† ÎåÄÎπÑ 32% ÎÇÆÏäµÎãàÎã§. ÌòÑÏû¨ Ïù¥ ÏÑ∏Í∑∏Î®ºÌä∏ ÎÖ∏Ï∂úÏù¥ 12%Ïóê Î∂àÍ≥ºÌïòÎØÄÎ°ú, 25%Î°ú Ï¶ùÍ∞ÄÏãúÌÇ§Î©¥ Ï†ÑÏ≤¥ CACÎ•º 10,200ÏõêÍπåÏßÄ ÎÇÆÏ∂ú Ïàò ÏûàÏäµÎãàÎã§.',
    details: ['ÏÑ∏Í∑∏Î®ºÌä∏ CAC: 8,500Ïõê', 'ÌòÑÏû¨ Ï†ÑÏ≤¥ CAC: 12,500Ïõê', 'ÏòàÏÉÅ CAC Í∞êÏÜå: -18%'],
    action: 'ÎÖ∏Ï∂ú ÎπàÎèÑ ÏµúÏ†ÅÌôî'
  },
  {
    icon: 'üéØ',
    type: 'info',
    title: 'Ïã†Í∑ú Í≥†Í∞ù ROAS 3.8x - ÌÖåÌÅ¨ Ïπ¥ÌÖåÍ≥†Î¶¨ √ó Ïä§ÌÅ¨Î°§ 60-80% Ï°∞Ìï© Î∞úÍ≤¨',
    message: 'Ïπ¥ÌÖåÍ≥†Î¶¨ ID 8(ÌÖåÌÅ¨)ÏóêÏÑú Ïä§ÌÅ¨Î°§ ÍπäÏù¥ 60-80% Íµ¨Í∞ÑÏùò Ïã†Í∑ú Í≥†Í∞ù ROASÍ∞Ä 5.2xÎ°ú ÎÜíÏäµÎãàÎã§. Ïù¥ Ï°∞Ìï©Ïóê ÎßûÏ∂§Ìòï Ïã†Í∑ú Í≥†Í∞ù ÌÉÄÍ≤üÌåÖÏùÑ Ï†ÅÏö©ÌïòÎ©¥ Ïã†Í∑ú Í≥†Í∞ù ROASÍ∞Ä 4.6xÎ°ú Ìñ•ÏÉÅÎê† Í≤ÉÏúºÎ°ú ÏòàÏÉÅÎê©ÎãàÎã§.',
    details: ['Ï°∞Ìï© Ïã†Í∑ú ROAS: 5.2x', 'ÌòÑÏû¨ Ïã†Í∑ú ROAS: 3.8x', 'ÏòàÏÉÅ Ïã†Í∑ú ROAS Ï¶ùÍ∞Ä: +21%'],
    action: 'Ïã†Í∑ú Í≥†Í∞ù ÌÉÄÍ≤üÌåÖ Í∞ïÌôî'
  }
])

// ÎßàÏºÄÌåÖ Ïö©Ïñ¥ Ï∞∏Í≥†Ìëú
const marketingTerms = ref([
  { term: 'ROAS', korean: 'Í¥ëÍ≥†ÏàòÏùµÎ•†', description: 'Í¥ëÍ≥†ÎπÑ ÎåÄÎπÑ Îß§Ï∂ú ÎπÑÏú® (Revenue √∑ Ad Spend)' },
  { term: 'CAC', korean: 'Í≥†Í∞ùÌöçÎìùÎπÑÏö©', description: 'Ïã†Í∑ú Í≥†Í∞ù Ìïú Î™Ö ÌôïÎ≥¥ÌïòÎäî Îç∞ Îì† ÎπÑÏö©' },
  { term: 'LTV', korean: 'Í≥†Í∞ùÏÉùÏï†Í∞ÄÏπò', description: 'Ìïú Í≥†Í∞ùÏù¥ Ï†ÑÏ≤¥ ÏÉùÏï† ÎèôÏïà ÎßåÎì§Ïñ¥ÎÇº Îß§Ï∂ú' },
  { term: 'CTR', korean: 'ÌÅ¥Î¶≠Î•†', description: 'Í¥ëÍ≥† ÎÖ∏Ï∂ú ÎåÄÎπÑ ÌÅ¥Î¶≠ ÎπÑÏú®' },
  { term: 'CVR', korean: 'Ï†ÑÌôòÏú®', description: 'ÌÅ¥Î¶≠ ÎåÄÎπÑ Íµ¨Îß§/Í∞ÄÏûÖ Îì± Î™©Ìëú ÌñâÎèô ÎπÑÏú®' },
  { term: 'ÏΩòÌÖêÏ∏† Ïπ¥ÌÖåÍ≥†Î¶¨', korean: 'ÏΩòÌÖêÏ∏† Ïú†Ìòï', description: 'Í¥ëÍ≥†Í∞Ä ÎÖ∏Ï∂úÎêú ÏΩòÌÖêÏ∏†Ïùò Î∂ÑÎ•ò (ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº, ÌÖåÌÅ¨ Îì±)' },
  { term: 'Ïä§ÌÅ¨Î°§ ÍπäÏù¥', korean: 'ÌéòÏù¥ÏßÄ ÌÉêÏÉâÎèÑ', description: 'ÏÇ¨Ïö©ÏûêÍ∞Ä ÌéòÏù¥ÏßÄÎ•º ÏñºÎßàÎÇò ÍπäÏù¥ ÌÉêÏÉâÌñàÎäîÏßÄ ÎπÑÏú®' },
  { term: '7Ïùº ÎÖ∏Ï∂ú', korean: 'ÎÖ∏Ï∂ú ÎπàÎèÑ', description: 'Í∞ôÏùÄ ÏÇ¨Ïö©ÏûêÏóêÍ≤å 7ÏùºÍ∞Ñ Í¥ëÍ≥†Í∞Ä ÎÖ∏Ï∂úÎêú ÌöüÏàò' },
  { term: 'ÏÉÅÌò∏ÏûëÏö© Ìö®Í≥º', korean: 'Ï°∞Ìï© Ìö®Í≥º', description: 'Ïó¨Îü¨ ÌîºÏ≤òÍ∞Ä Ìï®Íªò ÏûëÏö©Ìï† ÎïåÏùò ÏãúÎÑàÏßÄ Ìö®Í≥º' },
  { term: 'ÏΩîÌò∏Ìä∏ Î¶¨ÌÖêÏÖò', korean: 'Ïû¨Î∞©Î¨∏Ïú®', description: 'ÌäπÏ†ï Í∏∞Í∞ÑÏóê Ïú†ÏûÖÎêú Í≥†Í∞ùÏùò Ïû¨Î∞©Î¨∏ ÎπÑÏú®' }
])

// Í≥†Í∞ù ÏÑ∏Í∑∏Î®ºÌä∏ - ÎßàÏºÄÌåÖ KPI Í∏∞Î∞ò ÏÑ∏Î∂ÑÌôî Î∂ÑÏÑù
const customerSegments = ref([
  {
    name: 'ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº + ÍπäÏùÄ ÌÉêÏÉâ',
    performance: 'success',
    label: 'ÏµúÏö∞Ïàò',
    roas: 6.8,
    cac: 8500,
    ltv: 245000,
    ctr: 7.3,
    cvr: 12.5,
    potential: 92,
    correlation: 0.78
  },
  {
    name: 'Ï†ÅÏ†ï ÎÖ∏Ï∂ú Í∑∏Î£π',
    performance: 'success',
    label: 'Ïö∞Ïàò',
    roas: 5.2,
    cac: 9200,
    ltv: 198000,
    ctr: 6.2,
    cvr: 10.8,
    potential: 88,
    correlation: 0.72
  },
  {
    name: 'ÌÖåÌÅ¨ + Ï§ëÍ∞Ñ ÌÉêÏÉâ',
    performance: 'warning',
    label: 'Î≥¥ÌÜµ',
    roas: 4.1,
    cac: 11200,
    ltv: 165000,
    ctr: 5.8,
    cvr: 8.9,
    potential: 75,
    correlation: 0.65
  },
  {
    name: 'ÏùºÎ∞ò + ÎÇÆÏùÄ ÌÉêÏÉâ',
    performance: 'info',
    label: 'Í∞úÏÑ† ÌïÑÏöî',
    roas: 2.8,
    cac: 15800,
    ltv: 125000,
    ctr: 3.1,
    cvr: 5.2,
    potential: 52,
    correlation: 0.41
  }
])

// ÏµúÏ†Å ÏãúÍ∞ÑÎåÄ - Ïä§ÌÅ¨Î°§ ÍπäÏù¥ÏôÄ ÎÖ∏Ï∂ú ÌöüÏàò Í∏∞Î∞ò Î∂ÑÏÑù
const optimalTimeSlots = ref([
  {
    period: '06:00 - 10:00',
    ctr: 65,
    traffic: 'Ï§ë',
    color: '#67c23a',
    isBest: false,
    scrollDepth: 'ÌèâÍ∑† 45%',
    exposureCount: '2.3Ìöå'
  },
  {
    period: '10:00 - 14:00',
    ctr: 72,
    traffic: 'ÎÜíÏùå',
    color: '#409eff',
    isBest: false,
    scrollDepth: 'ÌèâÍ∑† 52%',
    exposureCount: '3.1Ìöå'
  },
  {
    period: '14:00 - 18:00',
    ctr: 68,
    traffic: 'Ï§ë',
    color: '#67c23a',
    isBest: false,
    scrollDepth: 'ÌèâÍ∑† 48%',
    exposureCount: '2.8Ìöå'
  },
  {
    period: '18:00 - 22:00',
    ctr: 88,
    traffic: 'Îß§Ïö∞ ÎÜíÏùå',
    color: '#f56c6c',
    isBest: true,
    scrollDepth: 'ÌèâÍ∑† 78%',
    exposureCount: '4.2Ìöå'
  },
  {
    period: '22:00 - 02:00',
    ctr: 55,
    traffic: 'ÎÇÆÏùå',
    color: '#e6a23c',
    isBest: false,
    scrollDepth: 'ÌèâÍ∑† 35%',
    exposureCount: '1.9Ìöå'
  }
])

// ÎßàÏºÄÌåÖ Ï†ÑÎûµ - KPI Í∏∞Î∞ò Ï†ÑÎûµÏ†Å Ïã§Ìñâ Í≥ÑÌöç
const marketingStrategies = ref([
  {
    id: 1,
    priority: 'high',
    priorityLabel: 'ÎÜíÏùÄ Ïö∞ÏÑ†ÏàúÏúÑ',
    title: 'ROAS ÏµúÏ†ÅÌôî - Ïπ¥ÌÖåÍ≥†Î¶¨ ID 15 √ó Ïä§ÌÅ¨Î°§ 80%+ Ï°∞Ìï© ÏßëÏ§ë',
    description: 'ROAS 6.8x Îã¨ÏÑ± ÏÑ∏Í∑∏Î®ºÌä∏Ïóê Í¥ëÍ≥† ÏòàÏÇ∞Ïùò 35%Î•º Ïû¨Î∞∞ÏπòÌïòÏó¨ Ï†ÑÏ≤¥ ROASÎ•º 4.2xÏóêÏÑú 5.1xÎ°ú ÏÉÅÏäπÏãúÌÇµÎãàÎã§.',
    impact: 21,
    duration: '2Ï£º',
    budget: '800ÎßåÏõê',
    expectedROAS: 5.1,
    expectedCAC: 10200,
    correlation: 0.78
  },
  {
    id: 2,
    priority: 'high',
    priorityLabel: 'ÎÜíÏùÄ Ïö∞ÏÑ†ÏàúÏúÑ',
    title: 'CAC ÏµúÏ†ÅÌôî - 7Ïùº ÎÖ∏Ï∂ú 3-5Ìöå ÏÑ∏Í∑∏Î®ºÌä∏ ÌôïÎåÄ',
    description: 'CAC 8,500Ïõê Îã¨ÏÑ± ÏÑ∏Í∑∏Î®ºÌä∏Ïùò ÎÖ∏Ï∂úÏùÑ 12%ÏóêÏÑú 25%Î°ú Ï¶ùÍ∞ÄÏãúÏºú Ï†ÑÏ≤¥ CACÎ•º 12,500ÏõêÏóêÏÑú 10,200ÏõêÏúºÎ°ú Í∞êÏÜåÏãúÌÇµÎãàÎã§.',
    impact: 18,
    duration: '1Ï£º',
    budget: '500ÎßåÏõê',
    expectedROAS: 4.8,
    expectedCAC: 10200,
    correlation: 0.72
  },
  {
    id: 3,
    priority: 'medium',
    priorityLabel: 'Ï§ëÍ∞Ñ Ïö∞ÏÑ†ÏàúÏúÑ',
    title: 'Ïã†Í∑ú Í≥†Í∞ù ROAS Í∞ïÌôî - ÌÖåÌÅ¨ Ïπ¥ÌÖåÍ≥†Î¶¨ ÌÉÄÍ≤üÌåÖ',
    description: 'Ïπ¥ÌÖåÍ≥†Î¶¨ ID 8 √ó Ïä§ÌÅ¨Î°§ 60-80% Ï°∞Ìï©Ïóê Ïã†Í∑ú Í≥†Í∞ù ÎßûÏ∂§Ìòï Í¥ëÍ≥†Î•º Î∞∞ÏπòÌïòÏó¨ Ïã†Í∑ú Í≥†Í∞ù ROASÎ•º 3.8xÏóêÏÑú 4.6xÎ°ú Ìñ•ÏÉÅÏãúÌÇµÎãàÎã§.',
    impact: 21,
    duration: '3Ï£º',
    budget: '600ÎßåÏõê',
    expectedROAS: 4.6,
    expectedCAC: 11500,
    correlation: 0.65
  }
])

// ÏÑ±Í≥º ÏöîÏïΩ
const performanceSummary = ref([
  {
    date: '2025-10-15',
    color: '#67c23a',
    title: 'CTR 3.8% Îã¨ÏÑ±',
    description: 'Ï†ÑÏõî ÎåÄÎπÑ 12.5% ÏÉÅÏäπ'
  },
  {
    date: '2025-10-10',
    color: '#409eff',
    title: 'ÏÉàÎ°úÏö¥ Î™®Îç∏ Î∞∞Ìè¨',
    description: 'ÏòàÏ∏° Ï†ïÌôïÎèÑ 87.5%Î°ú Ìñ•ÏÉÅ'
  },
  {
    date: '2025-10-05',
    color: '#e6a23c',
    title: 'ÎßàÏºÄÌåÖ Ï†ÑÎûµ ÏóÖÎç∞Ïù¥Ìä∏',
    description: 'AI Ï∂îÏ≤ú Ï†ÑÎûµ 3Í∞ú Ï†ÅÏö©'
  }
])

const customColors = [
  { color: '#f56c6c', percentage: 30 },
  { color: '#e6a23c', percentage: 60 },
  { color: '#67c23a', percentage: 100 }
]

// Methods
const applyRecommendation = (insight) => {
  ElMessage.success(`"${insight.title}" Ï†ÑÎûµÏùÑ Ï†ÅÏö©Ìï©ÎãàÎã§.`)
}

const goToUpload = () => {
  router.push('/upload')
}

const viewFullReport = () => {
  router.push('/report/latest')
}

const downloadReport = async () => {
  downloadingPDF.value = true
  try {
    const loading = ElMessage({
      message: 'AIÍ∞Ä ÎßûÏ∂§Ìòï Î≥¥Í≥†ÏÑúÎ•º ÏÉùÏÑ±ÌïòÎäî Ï§ëÏûÖÎãàÎã§...',
      type: 'info',
      duration: 0
    })

    try {
      // Î∞±ÏóîÎìú AI ÏÉùÏÑ± PDF Îã§Ïö¥Î°úÎìú ÏãúÎèÑ
      const response = await api.downloadPDFReport('latest')
      
      const blob = new Blob([response], { type: 'application/pdf' })
      const url = window.URL.createObjectURL(blob)
      const link = document.createElement('a')
      link.href = url
      link.download = `SK_AX_Í≥†Í∞ùÏÇ¨_Î≥¥Í≥†ÏÑú_${Date.now()}.pdf`
      document.body.appendChild(link)
      link.click()
      document.body.removeChild(link)
      window.URL.revokeObjectURL(url)

      loading.close()
      ElMessage.success('Î≥¥Í≥†ÏÑúÍ∞Ä Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§!')
    } catch (error) {
      loading.close()
      console.error('PDF download error:', error)
      ElMessage.warning('Î∞±ÏóîÎìú ÎØ∏Ïó∞Í≤∞ ÏÉÅÌÉúÏûÖÎãàÎã§. AI Î≥¥Í≥†ÏÑú ÌéòÏù¥ÏßÄÏóêÏÑú Îã§Ïö¥Î°úÎìúÌïòÏÑ∏Ïöî.')
      setTimeout(() => {
        router.push('/report/latest')
      }, 1500)
    }
  } finally {
    downloadingPDF.value = false
  }
}

const refreshRecommendations = () => {
  ElMessage.success('ÏµúÏã† Ï∂îÏ≤ú Ï†ÑÎûµÏùÑ Î∂àÎü¨ÏôîÏäµÎãàÎã§.')
}

const viewStrategyDetails = (strategy) => {
  ElMessage.info(`"${strategy.title}" ÏÉÅÏÑ∏ Ï†ïÎ≥¥Î•º ÌôïÏù∏Ìï©ÎãàÎã§.`)
}

const getPriorityType = (priority) => {
  const types = {
    high: 'danger',
    medium: 'warning',
    low: 'info'
  }
  return types[priority] || 'info'
}
</script>

<style scoped>
.client-dashboard {
  padding: 0;
}

.kpi-row {
  margin-bottom: 20px;
}

.kpi-card {
  border: none;
  border-radius: 16px;
  overflow: hidden;
}

.gradient-blue {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.gradient-green {
  background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
  color: white;
}

.gradient-purple {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  color: white;
}

.gradient-orange {
  background: linear-gradient(135deg, #ff9a56 0%, #ff6b6b 100%);
  color: white;
}

.kpi-content {
  display: flex;
  align-items: center;
  gap: 20px;
  padding: 10px 0;
}

.kpi-icon {
  opacity: 0.9;
}

.kpi-info {
  flex: 1;
}

.kpi-label {
  font-size: 14px;
  opacity: 0.9;
  margin-bottom: 8px;
}

.kpi-value {
  font-size: 36px;
  font-weight: bold;
  line-height: 1;
  margin-bottom: 8px;
}

.kpi-change {
  font-size: 14px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 4px;
}

.kpi-subtext {
  font-size: 13px;
  opacity: 0.85;
  margin-top: 4px;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: bold;
}

.insights-card {
  height: 100%;
}

.insights-list {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.insight-item {
  padding: 20px;
  border-radius: 12px;
  border-left: 4px solid;
  background: #f8f9fa;
}

.insight-item.insight-success {
  border-color: #67c23a;
  background: #f0f9ff;
}

.insight-item.insight-warning {
  border-color: #e6a23c;
  background: #fffbf0;
}

.insight-item.insight-info {
  border-color: #409eff;
  background: #f4f7fc;
}

.insight-header {
  display: flex;
  gap: 16px;
  margin-bottom: 12px;
}

.insight-icon {
  font-size: 32px;
  line-height: 1;
}

.insight-content h4 {
  font-size: 16px;
  margin-bottom: 8px;
  color: #2c3e50;
}

.insight-content p {
  font-size: 14px;
  line-height: 1.6;
  color: #606266;
}

.insight-details {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin: 12px 0;
}

.detail-tag {
  background: white;
}

.insight-action {
  margin-top: 12px;
}

.quick-actions {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.action-btn {
  width: 100%;
  justify-content: flex-start;
}

.segment-analysis {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.segment-item {
  padding: 16px;
  background: #f8f9fa;
  border-radius: 8px;
}

.segment-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 12px;
}

.segment-name {
  font-size: 16px;
  font-weight: 600;
  color: #2c3e50;
}

.segment-metrics {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-bottom: 12px;
}

.metric {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.metric-label {
  font-size: 12px;
  color: #909399;
}

.metric-value {
  font-size: 18px;
  font-weight: 600;
  color: #303133;
}

.progress-text {
  font-size: 12px;
}

.time-analysis {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.time-slot {
  padding: 16px;
  background: #f8f9fa;
  border-radius: 8px;
  position: relative;
}

.time-slot.best-time {
  background: linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%);
  border: 2px solid #f56c6c;
}

.time-period {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 12px;
}

.time-metrics {
  display: grid;
  grid-template-columns: 2fr 1fr 1fr 1fr;
  gap: 16px;
  align-items: center;
}

.time-ctr {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.time-traffic,
.time-scroll,
.time-exposure {
  display: flex;
  flex-direction: column;
  align-items: center;
  min-width: 80px;
}

.traffic-value {
  font-size: 16px;
  font-weight: 600;
  color: #303133;
}

.traffic-label,
.scroll-label,
.exposure-label {
  font-size: 12px;
  color: #909399;
}

.scroll-value,
.exposure-value {
  font-size: 16px;
  font-weight: 600;
  color: #303133;
}

.best-badge {
  position: absolute;
  top: 12px;
  right: 12px;
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 4px 12px;
  background: #f56c6c;
  color: white;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.strategy-card {
  padding: 20px;
  border-radius: 12px;
  border: 2px solid #e4e7ed;
  background: white;
  height: 100%;
  display: flex;
  flex-direction: column;
}

.strategy-card.priority-high {
  border-color: #f56c6c;
  background: linear-gradient(to bottom, #fff5f5 0%, white 100%);
}

.strategy-card.priority-medium {
  border-color: #e6a23c;
}

.strategy-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.strategy-impact {
  font-size: 14px;
  font-weight: 600;
  color: #67c23a;
}

.strategy-card h3 {
  font-size: 18px;
  margin-bottom: 12px;
  color: #2c3e50;
}

.strategy-card p {
  font-size: 14px;
  line-height: 1.6;
  color: #606266;
  margin-bottom: 16px;
  flex: 1;
}

.strategy-details {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 16px;
}

.detail-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: #606266;
}

.strategy-action {
  width: 100%;
}
</style>

